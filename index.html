<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Messenger-Inspired Chat App</title>
<link href="https://fonts.googleapis.com/css?family=Inter:400,600&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
<style>
  /* Reset & base */
  *, *::before, *::after {
    box-sizing: border-box;
  }
  html {
    font-size: 16px;
    font-family: 'Inter', sans-serif;
    background: #f0f2f5;
    color: #222;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  body, #app {
    margin: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* Glass morphism variables */
  :root {
    --header-height: 64px;
    --sidebar-width: 280px;
    --footer-height: 48px;

    --glass-bg: rgba(255 255 255 / 0.25);
    --glass-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
    --glass-border: 1px solid rgba(255 255 255 / 0.18);
    --primary-color: #1877f2;
    --secondary-color: #e4e6eb;
    --text-color: #050505;
    --text-secondary: #65676b;
    --bg-light: #f0f2f5;
    --scrollbar-track: #d9d9d9;
    --scrollbar-thumb: #b0b0b0;
  }

  /* Scrollbar style */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  ::-webkit-scrollbar-track {
    background: var(--scrollbar-track);
    border-radius: 8px;
  }
  ::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
    border-radius: 8px;
  }

  /* Utility */
  .hidden {
    display: none !important;
  }
  button {
    cursor: pointer;
  }
  button:focus-visible,
  input:focus-visible,
  textarea:focus-visible {
    outline: 3px solid var(--primary-color);
    outline-offset: 2px;
  }

  /* Login screen */
  #login-screen {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background:
      linear-gradient(135deg, #6c63ff 0%, #00bfa6 90%);
  }
  #login-screen form {
    background: var(--glass-bg);
    backdrop-filter: blur(15px);
    border-radius: 16px;
    padding: 3rem 2.5rem;
    min-width: 320px;
    max-width: 400px;
    box-shadow: var(--glass-shadow);
    border: var(--glass-border);
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }
  #login-screen h1 {
    font-weight: 700;
    font-size: clamp(1.75rem, 2vw, 2.25rem);
    color: white;
    text-align: center;
    margin-bottom: 0.5rem;
    user-select: none;
  }
  #login-screen label {
    color: white;
    font-weight: 600;
    font-size: 1rem;
  }
  #login-screen input[type="text"] {
    padding: 0.75rem 1rem;
    border-radius: 12px;
    border: none;
    font-size: 1rem;
    outline-offset: 2px;
  }
  #login-screen button {
    background: white;
    color: var(--primary-color);
    font-weight: 700;
    padding: 0.85rem 1rem;
    border-radius: 12px;
    border: none;
    font-size: 1rem;
    transition: background-color 0.3s ease;
  }
  #login-screen button:hover,
  #login-screen button:focus-visible {
    background-color: #dde5ff;
  }
  #login-error {
    color: #ff6b6b;
    font-weight: 600;
    font-size: 0.9rem;
    text-align: center;
    margin-top: -1rem;
  }

  /* App layout */
  #app-container {
    display: flex;
    flex: 1 1 auto;
    height: 100vh;
    overflow: hidden;
    background: var(--bg-light);
  }
  header.app-header {
    position: sticky;
    top: 0;
    height: var(--header-height);
    flex-shrink: 0;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    box-shadow: var(--glass-shadow);
    border-bottom: var(--glass-border);
    display: flex;
    align-items: center;
    padding: 0 24px;
    gap: 1rem;
    z-index: 100;
  }
  header .logo {
    font-weight: 800;
    font-size: clamp(1.25rem, 1.5vw, 1.75rem);
    color: var(--primary-color);
    user-select: none;
  }
  header .user-info {
    margin-left: auto;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-weight: 600;
    color: var(--text-color);
  }
  header .user-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background-color: var(--primary-color);
    color: white;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
  }
  header button#logout-btn {
    background: transparent;
    border: none;
    color: var(--text-secondary);
    font-size: 24px;
    transition: color 0.3s ease;
  }
  header button#logout-btn:hover,
  header button#logout-btn:focus-visible {
    color: var(--primary-color);
  }

  /* Sidebar */
  nav.sidebar {
    width: var(--sidebar-width);
    padding: 1rem 0;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    box-shadow: var(--glass-shadow);
    border-right: var(--glass-border);
    display: flex;
    flex-direction: column;
    gap: 1rem;
    flex-shrink: 0;
  }
  nav.sidebar header {
    padding: 0 1.25rem;
    font-weight: 700;
    font-size: 1.25rem;
    color: var(--primary-color);
    user-select: none;
  }
  nav.sidebar ul {
    list-style: none;
    padding: 0;
    margin: 0;
    flex: 1;
    overflow-y: auto;
  }
  nav.sidebar ul li {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.6rem 1.25rem;
    cursor: pointer;
    border-radius: 12px;
    transition: background-color 0.3s ease;
    color: var(--text-secondary);
    user-select: none;
  }
  nav.sidebar ul li.active,
  nav.sidebar ul li:hover,
  nav.sidebar ul li:focus-visible {
    background-color: rgba(24, 119, 242, 0.12);
    color: var(--primary-color);
    outline: none;
  }
  nav.sidebar ul li .material-icons {
    font-size: 24px;
  }
  /* Notification badge */
  nav.sidebar ul li .badge {
    margin-left: auto;
    background: var(--primary-color);
    color: white;
    font-size: 0.75rem;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 12px;
    min-width: 20px;
    text-align: center;
  }

  /* Main chat area */
  main.chat-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: white;
    box-shadow: inset 0 0 20px rgb(0 0 0 / 0.03);
    overflow: hidden;
  }
  .chat-header {
    height: 72px;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border-bottom: var(--glass-border);
    display: flex;
    align-items: center;
    padding: 0 1.5rem;
    font-weight: 700;
    color: var(--primary-color);
    user-select: none;
  }
  .chat-messages {
    flex: 1;
    padding: 20px 24px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  /* Scrollbar for chat */
  .chat-messages::-webkit-scrollbar {
    width: 8px;
  }
  .chat-messages::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
    border-radius: 20px;
  }

  /* Chat message bubble */
  .message {
    max-width: 65%;
    padding: 12px 16px;
    border-radius: 20px;
    font-size: clamp(0.9rem, 1vw, 1rem);
    line-height: 1.4;
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.05);
    position: relative;
    word-wrap: break-word;
    background: var(--secondary-color);
  }
  .message.sent {
    align-self: flex-end;
    background: var(--primary-color);
    color: white;
    border-bottom-right-radius: 6px;
  }
  .message.received {
    align-self: flex-start;
    background: var(--secondary-color);
    color: var(--text-color);
    border-bottom-left-radius: 6px;
  }
  .message .meta {
    font-size: 0.75rem;
    color: var(--text-secondary);
    margin-bottom: 6px;
    font-weight: 600;
  }
  .message.sent .meta {
    color: #cce0ff;
  }

  /* Media content styles inside messages */
  .message img,
  .message video,
  .message audio {
    max-width: 100%;
    border-radius: 12px;
    margin-top: 8px;
    box-shadow: 0 2px 6px rgb(0 0 0 / 0.1);
    display: block;
  }
  video {
    max-height: 180px;
  }
  audio {
    width: 100%;
    margin-top: 4px;
  }

  /* Chat input area */
  .chat-input-area {
    display: flex;
    padding: 12px 20px;
    gap: 12px;
    background: var(--glass-bg);
    border-top: var(--glass-border);
    backdrop-filter: blur(20px);
  }
  .chat-input-area textarea {
    resize: none;
    border-radius: 16px;
    border: none;
    padding: 12px 16px;
    font-size: 1rem;
    font-family: inherit;
    flex: 1;
    min-height: 48px;
    max-height: 96px;
    outline-offset: 2px;
    box-shadow: inset 0 1px 3px rgb(0 0 0 / 0.1);
  }
  .chat-input-area textarea:focus {
    box-shadow: 0 0 5px var(--primary-color);
  }
  .chat-input-area button {
    border: none;
    background: var(--primary-color);
    color: white;
    border-radius: 50%;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    transition: background-color 0.3s ease;
  }
  .chat-input-area button:disabled {
    background: #8ab3ff;
    cursor: not-allowed;
  }
  .chat-input-area button:hover:not(:disabled),
  .chat-input-area button:focus-visible:not(:disabled) {
    background: #0f60e9;
  }

  /* Media buttons panel */
  .media-buttons {
    display: flex;
    gap: 12px;
  }
  .media-buttons label {
    cursor: pointer;
    background: var(--secondary-color);
    border-radius: 50%;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary-color);
    box-shadow: 0 1px 4px rgb(0 0 0 / 0.1);
    transition: background-color 0.3s ease;
  }
  .media-buttons label:hover,
  .media-buttons label:focus-visible {
    background: rgba(24, 119, 242, 0.12);
    outline: none;
  }
  .media-buttons input[type="file"] {
    display: none;
  }

  /* Footer */
  footer.app-footer {
    height: var(--footer-height);
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border-top: var(--glass-border);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-secondary);
    font-size: 0.85rem;
    user-select: none;
    flex-shrink: 0;
  }

  /* Responsive */
  @media (max-width: 767px) {
    nav.sidebar {
      position: fixed;
      z-index: 120;
      top: var(--header-height);
      left: 0;
      height: calc(100vh - var(--header-height));
      background: var(--glass-bg);
      box-shadow: var(--glass-shadow);
      border-right: var(--glass-border);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      width: 280px;
    }
    nav.sidebar.open {
      transform: translateX(0);
    }
    main.chat-area {
      margin-left: 0;
    }
    header.app-header {
      padding-left: 12px;
      padding-right: 12px;
    }
    #menu-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: none;
      color: var(--primary-color);
      font-size: 28px;
      cursor: pointer;
      margin-right: 0.5rem;
    }
  }
  @media (min-width: 768px) {
    #menu-toggle {
      display: none;
    }
  }
</style>
</head>
<body>
  <!-- Login screen -->
  <section id="login-screen" aria-label="Login Screen">
    <form id="login-form" aria-describedby="login-error" novalidate>
      <h1>Welcome to Chat</h1>
      <label for="username-input">Enter your name or nickname</label>
      <input type="text" id="username-input" name="username" autocomplete="name" required aria-required="true" placeholder="Your name or nickname" minlength="2" maxlength="32" />
      <div id="login-error" role="alert" aria-live="assertive" class="hidden"></div>
      <button type="submit" aria-label="Submit name and enter chat">Enter Chat</button>
    </form>
  </section>

  <!-- Main app container -->
  <div id="app" class="hidden" role="main" aria-label="Chat Application">
    <header class="app-header" role="banner">
      <button id="menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="sidebar-nav">
        <span class="material-icons">menu</span>
      </button>
      <div class="logo" aria-live="polite" aria-atomic="true">ChatApp</div>
      <div class="user-info" aria-label="Logged in user">
        <div class="user-avatar" aria-hidden="true"></div>
        <span id="display-username" tabindex="0"></span>
        <button id="logout-btn" title="Logout" aria-label="Logout from chat interface">
          <span class="material-icons">logout</span>
        </button>
      </div>
    </header>

    <nav id="sidebar-nav" class="sidebar" role="navigation" aria-label="Sidebar navigation">
      <header>Chats</header>
      <ul id="chat-list" tabindex="0" aria-live="polite" aria-relevant="additions">
        <!-- Example chat contact placeholder -->
        <li class="active" tabindex="0" aria-current="page"><span class="material-icons">chat</span> General Chat <span class="badge" aria-label="Unread messages">3</span></li>
      </ul>
    </nav>

    <main class="chat-area">
      <div class="chat-header" aria-live="polite" id="chat-header-title" tabindex="0" aria-atomic="true">
        General Chat
      </div>
      <section class="chat-messages" id="chat-messages" tabindex="0" role="log" aria-live="polite" aria-relevant="additions">
        <!-- Messages will appear here -->
      </section>
      <form class="chat-input-area" id="chat-input-form" aria-label="Send message form">
        <div class="media-buttons" role="group" aria-label="Media attachment buttons">
          <label for="image-upload" title="Attach image" aria-label="Attach image">
            <span class="material-icons">image</span>
            <input type="file" id="image-upload" accept="image/*" />
          </label>
          <label for="audio-upload" title="Attach audio" aria-label="Attach audio">
            <span class="material-icons">audiotrack</span>
            <input type="file" id="audio-upload" accept="audio/*" />
          </label>
          <label for="video-upload" title="Attach video" aria-label="Attach video">
            <span class="material-icons">videocam</span>
            <input type="file" id="video-upload" accept="video/*" />
          </label>
        </div>
        <textarea id="message-input" placeholder="Type a message" aria-label="Type your message" rows="1" autocomplete="off"></textarea>
        <button type="submit" id="send-btn" aria-label="Send message" disabled>
          <span class="material-icons">send</span>
        </button>
      </form>
    </main>

    <footer class="app-footer" role="contentinfo" aria-live="polite" aria-atomic="true">
      &copy; 2024 ChatApp • All rights reserved
    </footer>
  </div>

<script>
  (() => {
    const loginScreen = document.getElementById('login-screen');
    const appContainer = document.getElementById('app');
    const loginForm = document.getElementById('login-form');
    const usernameInput = document.getElementById('username-input');
    const loginError = document.getElementById('login-error');
    const displayUsername = document.getElementById('display-username');
    const userAvatar = document.querySelector('.user-avatar');
    const logoutBtn = document.getElementById('logout-btn');
    const chatMessages = document.getElementById('chat-messages');
    const chatInputForm = document.getElementById('chat-input-form');
    const messageInput = document.getElementById('message-input');
    const sendBtn = document.getElementById('send-btn');
    const chatList = document.getElementById('chat-list');
    const sidebarNav = document.getElementById('sidebar-nav');
    const menuToggle = document.getElementById('menu-toggle');

    let username = null;
    let messages = []; // array of {id, user, type, content, timestamp}

    // On load, check if user already logged in
    if (sessionStorage.getItem('chatAppUser')) {
      username = sessionStorage.getItem('chatAppUser');
      showApp();
    } else {
      showLogin();
    }

    // Generate avatar initials
    function generateAvatarInitials(name) {
      return name.trim().split(' ').map(s => s[0]).slice(0, 2).join('').toUpperCase();
    }

    // Show login screen
    function showLogin() {
      loginScreen.classList.remove('hidden');
      appContainer.classList.add('hidden');
      usernameInput.value = '';
      loginError.classList.add('hidden');
      usernameInput.focus();
    }

    // Show app screen
    function showApp() {
      loginScreen.classList.add('hidden');
      appContainer.classList.remove('hidden');
      displayUsername.textContent = username;
      userAvatar.textContent = generateAvatarInitials(username);
      // Load messages from sessionStorage
      const savedMessages = sessionStorage.getItem('chatAppMessages');
      messages = savedMessages ? JSON.parse(savedMessages) : [];
      renderMessages();
      scrollToBottom();
    }

    // Render messages in chat
    function renderMessages() {
      chatMessages.innerHTML = '';
      messages.forEach(msg => {
        const msgEl = createMessageElement(msg);
        chatMessages.appendChild(msgEl);
      });
    }

    // Create message DOM element
    function createMessageElement(msg) {
      const el = document.createElement('article');
      el.className = `message ${msg.user === username ? 'sent' : 'received'}`;
      el.setAttribute('tabindex', '0');
      el.setAttribute('role', 'article');
      el.setAttribute('aria-label', `${msg.user === username ? 'Sent' : 'Received'} ${msg.type} message from ${msg.user}`);

      // Meta info
      const meta = document.createElement('div');
      meta.className = 'meta';
      meta.textContent = `${msg.user} • ${new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
      el.appendChild(meta);

      // Content
      if (msg.type === 'text') {
        const p = document.createElement('p');
        p.textContent = msg.content;
        el.appendChild(p);
      } else if (msg.type === 'image') {
        const img = document.createElement('img');
        img.src = msg.content;
        img.alt = `Image sent by ${msg.user}`;
        img.loading = 'lazy';
        el.appendChild(img);
      } else if (msg.type === 'audio') {
        const audio = document.createElement('audio');
        audio.controls = true;
        audio.src = msg.content;
        audio.setAttribute('aria-label', `Audio message sent by ${msg.user}`);
        el.appendChild(audio);
      } else if (msg.type === 'video') {
        const video = document.createElement('video');
        video.controls = true;
        video.src = msg.content;
        video.setAttribute('aria-label', `Video message sent by ${msg.user}`);
        el.appendChild(video);
      }
      return el;
    }

    // Scroll to bottom in chat window smoothly
    function scrollToBottom() {
      setTimeout(() => {
        chatMessages.scrollTo({
          top: chatMessages.scrollHeight,
          behavior: 'smooth'
        });
      }, 100);
    }

    // Validate username input on login
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const val = usernameInput.value.trim();
      console.log('Login form submit:', val);
      if (val.length < 2 || val.length > 32) {
        loginError.textContent = 'Name must be between 2 and 32 characters';
        loginError.classList.remove('hidden');
        usernameInput.focus();
        return;
      }
      loginError.classList.add('hidden');
      username = val;
      sessionStorage.setItem('chatAppUser', username);
      showApp();
    });

    // Logout button handler
    logoutBtn.addEventListener('click', () => {
      sessionStorage.removeItem('chatAppUser');
      sessionStorage.removeItem('chatAppMessages');
      username = null;
      messages = [];
      showLogin();
    });

    // Enable send button only if message or media present
    function updateSendButton() {
      sendBtn.disabled = messageInput.value.trim() === '' && !hasSelectedFiles();
    }
    function hasSelectedFiles() {
      return (
        imageUpload.files.length > 0 ||
        audioUpload.files.length > 0 ||
        videoUpload.files.length > 0
      );
    }

    // Media file inputs
    const imageUpload = document.getElementById('image-upload');
    const audioUpload = document.getElementById('audio-upload');
    const videoUpload = document.getElementById('video-upload');

    // Clear file inputs after sending
    function clearFileInputs() {
      imageUpload.value = '';
      audioUpload.value = '';
      videoUpload.value = '';
    }

    // Update send button on input change or file selection
    messageInput.addEventListener('input', updateSendButton);
    imageUpload.addEventListener('change', updateSendButton);
    audioUpload.addEventListener('change', updateSendButton);
    videoUpload.addEventListener('change', updateSendButton);

    // Send message handler
    chatInputForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      // Compose messages from input and uploaded files
      const newMessages = [];

      // Text message
      const text = messageInput.value.trim();
      if (text.length > 0) {
        newMessages.push({
          id: `msg-${Date.now()}-${Math.random().toString(36).substr(2, 7)}`,
          user: username,
          type: 'text',
          content: text,
          timestamp: Date.now()
        });
      }

      // Helper to read files as data URL
      async function fileToDataURL(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.onerror = () => reject(new Error('File read error'));
          reader.readAsDataURL(file);
        });
      }

      // Image files
      for (let file of imageUpload.files) {
        try {
          const dataUrl = await fileToDataURL(file);
          newMessages.push({
            id: `msg-${Date.now()}-${Math.random().toString(36).substr(2, 7)}`,
            user: username,
            type: 'image',
            content: dataUrl,
            timestamp: Date.now()
          });
        } catch {}
      }
      // Audio files
      for (let file of audioUpload.files) {
        try {
          const dataUrl = await fileToDataURL(file);
          newMessages.push({
            id: `msg-${Date.now()}-${Math.random().toString(36).substr(2, 7)}`,
            user: username,
            type: 'audio',
            content: dataUrl,
            timestamp: Date.now()
          });
        } catch {}
      }
      // Video files
      for (let file of videoUpload.files) {
        try {
          const dataUrl = await fileToDataURL(file);
          newMessages.push({
            id: `msg-${Date.now()}-${Math.random().toString(36).substr(2, 7)}`,
            user: username,
            type: 'video',
            content: dataUrl,
            timestamp: Date.now()
          });
        } catch {}
      }

      if (newMessages.length === 0) {
        return;
      }

      // Add messages to message array and save
      messages.push(...newMessages);
      sessionStorage.setItem('chatAppMessages', JSON.stringify(messages));
      renderMessages();
      scrollToBottom();

      // Clear input & files, disable send button
      messageInput.value = '';
      clearFileInputs();
      updateSendButton();
      messageInput.focus();
    });

    // Initial disable send button
    updateSendButton();

    // Accessibility: keyboard nav, focus
    menuToggle.addEventListener('click', () => {
      const expanded = menuToggle.getAttribute('aria-expanded') === 'true';
      menuToggle.setAttribute('aria-expanded', (!expanded).toString());
      sidebarNav.classList.toggle('open');
    });

    // Close sidebar when clicking outside (mobile)
    document.addEventListener('click', e => {
      if (!sidebarNav.contains(e.target) && !menuToggle.contains(e.target) && sidebarNav.classList.contains('open')) {
        sidebarNav.classList.remove('open');
        menuToggle.setAttribute('aria-expanded', 'false');
      }
    });

    // Accessibility: Adjust textarea height dynamically
    messageInput.addEventListener('input', () => {
      messageInput.style.height = 'auto';
      messageInput.style.height = messageInput.scrollHeight + 'px';
    });

    // Focus management on load
    window.addEventListener('load', () => {
      if (appContainer.classList.contains('hidden')) {
        usernameInput.focus();
      } else {
        messageInput.focus();
      }
    });
  })();
</script>
</body>
</html>

